import re


def formatar_cnpj(cnpj):
    if not cnpj:
        return None
    cnpj_numeros = re.sub(r'\D', '', str(cnpj))
    if len(cnpj_numeros) != 14:
        return cnpj
    return f"{cnpj_numeros[0:2]}.{cnpj_numeros[2:5]}.{cnpj_numeros[5:8]}/{cnpj_numeros[8:12]}-{cnpj_numeros[12:14]}"


def formatar_ie_goias(ie):
    if not ie:
        return None
    ie_numeros = re.sub(r'\D', '', str(ie))
    if len(ie_numeros) != 9:
        return ie
    return f"{ie_numeros[0:2]}.{ie_numeros[2:5]}.{ie_numeros[5:8]}-{ie_numeros[8:9]}"


def formatar_telefone(telefone):
    if not telefone:
        return None
    tel_numeros = re.sub(r'\D', '', str(telefone))
    if len(tel_numeros) == 11:
        return f"({tel_numeros[0:2]}) {tel_numeros[2:7]}-{tel_numeros[7:11]}"
    elif len(tel_numeros) == 10:
        return f"({tel_numeros[0:2]}) {tel_numeros[2:6]}-{tel_numeros[6:10]}"
    return telefone


def formatar_cep(cep):
    if not cep:
        return None
    cep_numeros = re.sub(r'\D', '', str(cep))
    if len(cep_numeros) != 8:
        return cep
    return f"{cep_numeros[0:5]}-{cep_numeros[5:8]}"


def formatar_moeda(valor):
    """
    Formata um número (float/int/str) para moeda BRL (ex.: R$ 1.234,56).
    Entrada: None -> retorna '-'
    Aceita strings já formatadas (tenta converter).
    """
    try:
        if valor is None or valor == '':
            return '-'
        if isinstance(valor, str):
            s = valor.strip().replace('R$', '').replace('r$', '').replace(' ', '')
            s = s.replace('.', '').replace(',', '.') if ('.' in s and ',' in s) else s.replace(',', '.')
            num = float(s)
        else:
            num = float(valor)
    except Exception:
        return '-'

    inteiro = int(abs(num))
    centavos = int(round((abs(num) - inteiro) * 100))
    inteiro_str = f"{inteiro:,}".replace(',', '.')
    sinal = '-' if num < 0 else ''
    return f"{sinal}R$ {inteiro_str},{centavos:02d}"
