# Diagrama de Permissões SUPERVISOR

## Estrutura de Usuários e Permissões

```
┌─────────────────────────────────────────────────────────────────────┐
│                         NÍVEIS DE ACESSO                            │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐  │
│  │   ADMIN    │  │  GERENTE   │  │ SUPERVISOR │  │   PISTA    │  │
│  │            │  │            │  │            │  │            │  │
│  │  Acesso    │  │  Gestão    │  │ Supervisão │  │ Operação   │  │
│  │   Total    │  │ Completa   │  │   Plena    │  │  Básica    │  │
│  └────────────┘  └────────────┘  └────────────┘  └────────────┘  │
│        │                │              │               │           │
│        │                │              │               │           │
│   Sem filtro      Opcional    Múltiplas empresas  1 empresa      │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

## Fluxo de Criação de Usuário SUPERVISOR

```
┌──────────────────────────────────────────────────────────────────────┐
│                    CRIAR USUÁRIO SUPERVISOR                          │
└──────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  1. Acessar /auth/usuarios/novo        │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  2. Preencher dados básicos:           │
         │     - Username                         │
         │     - Nome Completo                    │
         │     - Senha                            │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  3. Selecionar Nível: SUPERVISOR       │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  4. Campo "Empresas" aparece           │
         │     (Lista de clientes com produtos    │
         │      de posto configurados)            │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  5. Selecionar uma ou mais empresas    │
         │     ☑ Empresa A                        │
         │     ☑ Empresa B                        │
         │     ☐ Empresa C                        │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  6. Validação JavaScript:              │
         │     - Pelo menos 1 empresa?   ✓        │
         │     - Senhas coincidem?       ✓        │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  7. Backend (routes/auth.py):          │
         │     - Criar usuário                    │
         │     - Inserir em usuario_empresas      │
         └────────────────────────────────────────┘
                              │
                              ▼
         ┌────────────────────────────────────────┐
         │  ✓ Usuário SUPERVISOR criado!          │
         └────────────────────────────────────────┘
```

## Modelo de Dados

```
┌──────────────────┐         ┌──────────────────────┐         ┌───────────────┐
│    usuarios      │         │  usuario_empresas    │         │   clientes    │
├──────────────────┤         ├──────────────────────┤         ├───────────────┤
│ id (PK)          │◄───────┤│ usuario_id (FK)      │        ┌┤ id (PK)       │
│ username         │         │ cliente_id (FK)      │────────┘│ razao_social  │
│ nome_completo    │         │ criado_em            │         │ nome_fantasia │
│ nivel            │         └──────────────────────┘         │ ativo         │
│ cliente_id (FK)  │─────┐                                    └───────────────┘
│ ativo            │     │                                           │
│ password_hash    │     │                                           │
└──────────────────┘     │                                           │
        │                │   ┌──────────────────────┐                │
        │                │   │ clientes_produtos    │                │
        │                └──►│ (Config Produtos     │◄───────────────┘
        │                    │  Posto)              │
        │                    └──────────────────────┘
        │
        │   ┌──────────────────────┐
        └──►│ usuario_permissoes   │
            ├──────────────────────┤
            │ usuario_id (FK)      │
            │ secao                │
            │ pode_criar           │
            │ pode_editar          │
            │ pode_excluir         │
            └──────────────────────┘
```

## Fluxo de Verificação de Permissões

```
        ┌─────────────────────────────────────┐
        │  Usuário acessa rota protegida      │
        └─────────────────────────────────────┘
                       │
                       ▼
        ┌─────────────────────────────────────┐
        │  Decorator verifica autenticação    │
        │  @login_required                    │
        └─────────────────────────────────────┘
                       │
                       ▼
        ┌─────────────────────────────────────┐
        │  Decorator verifica nível           │
        │  @supervisor_or_admin_required      │
        └─────────────────────────────────────┘
                       │
           ┌───────────┴───────────┐
           │                       │
           ▼                       ▼
    ┌──────────┐           ┌─────────────┐
    │  ADMIN?  │           │ SUPERVISOR? │
    └──────────┘           └─────────────┘
         │ Sim                   │ Sim
         │                       │
         └───────────┬───────────┘
                     ▼
         ┌─────────────────────────────┐
         │  ✓ Acesso Permitido         │
         └─────────────────────────────┘
                     │
                     ▼
         ┌─────────────────────────────┐
         │  Executar função da rota    │
         └─────────────────────────────┘
```

## Seções Acessíveis por SUPERVISOR

```
┌────────────────────────────────────────────────────────────────┐
│                         CADASTRO                               │
├────────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────┐ │
│  │ Formas Pagamento │  │ Formas Recebim.  │  │   Cartões    │ │
│  │      Caixa       │  │      Caixa       │  │              │ │
│  └──────────────────┘  └──────────────────┘  └──────────────┘ │
│    /caixa/*              /tipos_receita_      /cartoes/*       │
│                           caixa/*                               │
└────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────┐
│                       LANÇAMENTOS                              │
├────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐           │
│  │Quilometragem│  │    Arla     │  │Vendas Posto │           │
│  └─────────────┘  └─────────────┘  └─────────────┘           │
│                                                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐           │
│  │ Fechamento  │  │  Troco Pix  │  │ Troco Pix   │           │
│  │   Caixa     │  │             │  │   Pista     │           │
│  └─────────────┘  └─────────────┘  └─────────────┘           │
└────────────────────────────────────────────────────────────────┘
```

## Comparação de Permissões

```
┌─────────────────┬──────────┬──────────┬────────────┬─────────┐
│     Seção       │  ADMIN   │ GERENTE  │ SUPERVISOR │  PISTA  │
├─────────────────┼──────────┼──────────┼────────────┼─────────┤
│ Criar Usuário   │    ✓     │    ✗     │     ✗      │    ✗    │
│ Editar Usuário  │    ✓     │    ✗     │     ✗      │    ✗    │
├─────────────────┼──────────┼──────────┼────────────┼─────────┤
│ Formas Pagto    │    ✓     │    ✓     │     ✓      │    ✗    │
│ Formas Receb    │    ✓     │    ✓     │     ✓      │    ✗    │
│ Cartões         │    ✓     │    ✓     │     ✓      │    ✗    │
├─────────────────┼──────────┼──────────┼────────────┼─────────┤
│ Quilometragem   │    ✓     │    ✓     │     ✓      │    ✓    │
│ Arla            │    ✓     │    ✓     │     ✓      │    ✓    │
│ Vendas Posto    │    ✓     │    ✓     │     ✓      │    ✓    │
│ Fechamento Caixa│    ✓     │    ✓     │     ✓      │    ✓    │
│ Troco Pix       │    ✓     │    ✓     │     ✓      │    ✓    │
├─────────────────┼──────────┼──────────┼────────────┼─────────┤
│ Limite Edição   │  Sem     │   Sem    │    Sem     │ 15 min  │
│ Filtro Empresas │  Todas   │ Opcional │ Selecionad │ 1 única │
└─────────────────┴──────────┴──────────┴────────────┴─────────┘
```

## Legenda

```
✓ = Acesso Permitido
✗ = Acesso Negado
PK = Primary Key (Chave Primária)
FK = Foreign Key (Chave Estrangeira)
```
