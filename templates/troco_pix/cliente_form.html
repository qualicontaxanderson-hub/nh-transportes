{% extends "base.html" %}

{% block title %}{{ 'Editar' if edit_mode else 'Novo' }} Cliente PIX{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-3">
        <div class="col-md-12">
            <h2>
                <i class="bi bi-person-plus"></i> 
                {{ 'Editar' if edit_mode else 'Novo' }} Cliente PIX
            </h2>
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('troco_pix.clientes') }}">Clientes PIX</a></li>
                    <li class="breadcrumb-item active">{{ 'Editar' if edit_mode else 'Novo Cliente' }}</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-person-badge"></i> Dados do Cliente PIX
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('troco_pix.cliente_editar', cliente_id=cliente.id, return_to=return_to) if edit_mode else url_for('troco_pix.cliente_novo', return_to=return_to) }}">
                        <!-- Campo hidden para retornar à página de origem -->
                        {% if return_to %}
                        <input type="hidden" name="return_to" value="{{ return_to }}">
                        {% endif %}
                        
                        <div class="mb-3">
                            <label for="nome_completo" class="form-label">Nome Completo *</label>
                            <input type="text" class="form-control" id="nome_completo" name="nome_completo" 
                                   required maxlength="200"
                                   value="{{ cliente.nome_completo if edit_mode else '' }}"
                                   placeholder="Ex: João da Silva">
                            <small class="form-text text-muted">Nome completo da pessoa que receberá o PIX</small>
                        </div>

                        <div class="mb-3">
                            <label for="tipo_chave_pix" class="form-label">Tipo de Chave PIX *</label>
                            <select class="form-control" id="tipo_chave_pix" name="tipo_chave_pix" required>
                                <option value="">Selecione...</option>
                                <option value="CPF" {% if edit_mode and cliente.tipo_chave_pix == 'CPF' %}selected{% endif %}>CPF</option>
                                <option value="CNPJ" {% if edit_mode and cliente.tipo_chave_pix == 'CNPJ' %}selected{% endif %}>CNPJ</option>
                                <option value="EMAIL" {% if edit_mode and cliente.tipo_chave_pix == 'EMAIL' %}selected{% endif %}>E-mail</option>
                                <option value="TELEFONE" {% if edit_mode and cliente.tipo_chave_pix == 'TELEFONE' %}selected{% endif %}>Telefone</option>
                                <option value="CHAVE_ALEATORIA" {% if edit_mode and cliente.tipo_chave_pix == 'CHAVE_ALEATORIA' %}selected{% endif %}>Chave Aleatória</option>
                            </select>
                            <small class="form-text text-muted">Selecione o tipo de chave PIX cadastrada</small>
                        </div>

                        <div class="mb-3">
                            <label for="chave_pix" class="form-label">Chave PIX *</label>
                            <input type="text" class="form-control" id="chave_pix" name="chave_pix" 
                                   required maxlength="200"
                                   value="{{ cliente.chave_pix if edit_mode else '' }}"
                                   placeholder="Digite a chave PIX">
                            <small class="form-text text-muted" id="chave_hint">
                                Digite a chave PIX conforme o tipo selecionado
                            </small>
                        </div>

                        {% if edit_mode %}
                        <div class="mb-3">
                            <label for="ativo" class="form-label">Status</label>
                            <select class="form-control" id="ativo" name="ativo">
                                <option value="1" {% if cliente.ativo %}selected{% endif %}>Ativo</option>
                                <option value="0" {% if not cliente.ativo %}selected{% endif %}>Inativo</option>
                            </select>
                        </div>
                        {% endif %}

                        <div class="mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-save"></i> {{ 'Atualizar' if edit_mode else 'Salvar' }}
                            </button>
                            <a href="{{ url_for('troco_pix.clientes') }}" class="btn btn-secondary btn-lg">
                                <i class="bi bi-x-circle"></i> Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Informações sobre tipos de chave PIX -->
            <div class="card mt-3">
                <div class="card-header bg-info text-white">
                    <i class="bi bi-info-circle"></i> Tipos de Chave PIX
                </div>
                <div class="card-body">
                    <ul>
                        <li><strong>CPF:</strong> Deve conter apenas números (11 dígitos). Ex: 12345678901</li>
                        <li><strong>CNPJ:</strong> Deve conter apenas números (14 dígitos). Ex: 12345678000123</li>
                        <li><strong>E-mail:</strong> Endereço de e-mail válido. Ex: usuario@exemplo.com</li>
                        <li><strong>Telefone:</strong> Número com DDD (11 dígitos). Ex: 62999887766</li>
                        <li><strong>Chave Aleatória:</strong> Código gerado pelo banco. Ex: 123e4567-e89b-12d3-a456-426614174000</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tipoChaveSelect = document.getElementById('tipo_chave_pix');
    const chaveInput = document.getElementById('chave_pix');
    const chaveHint = document.getElementById('chave_hint');

    // Atualizar placeholder e dica baseado no tipo de chave
    tipoChaveSelect.addEventListener('change', function() {
        switch(this.value) {
            case 'CPF':
                chaveInput.placeholder = 'Ex: 12345678901';
                chaveHint.textContent = 'Digite apenas números (11 dígitos)';
                break;
            case 'CNPJ':
                chaveInput.placeholder = 'Ex: 12345678000123';
                chaveHint.textContent = 'Digite apenas números (14 dígitos)';
                break;
            case 'EMAIL':
                chaveInput.placeholder = 'Ex: usuario@exemplo.com';
                chaveHint.textContent = 'Digite um e-mail válido';
                break;
            case 'TELEFONE':
                chaveInput.placeholder = 'Ex: 62999887766';
                chaveHint.textContent = 'Digite o DDD + número (11 dígitos sem espaços)';
                break;
            case 'CHAVE_ALEATORIA':
                chaveInput.placeholder = 'Ex: 123e4567-e89b-12d3-a456-426614174000';
                chaveHint.textContent = 'Cole a chave aleatória fornecida pelo banco';
                break;
            default:
                chaveInput.placeholder = 'Digite a chave PIX';
                chaveHint.textContent = 'Digite a chave PIX conforme o tipo selecionado';
        }
    });

    // Validação básica de CPF e CNPJ (apenas números)
    chaveInput.addEventListener('input', function() {
        if (tipoChaveSelect.value === 'CPF' || tipoChaveSelect.value === 'CNPJ' || tipoChaveSelect.value === 'TELEFONE') {
            // Remove tudo que não é número
            this.value = this.value.replace(/\D/g, '');
        }
    });
});
</script>
{% endblock %}
