{% extends "base.html" %}

{% block title %}Painel ARLA - NH Transportes{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 style="font-size: 1.5rem;">
            <i class="bi bi-droplet-half"></i> Painel ARLA
        </h2>
        <div>
            <a href="{{ url_for('arla.saldo_inicial') }}" class="btn btn-primary btn-sm me-2">
                <i class="bi bi-plus-circle"></i> Saldo Inicial
            </a>
            <a href="{{ url_for('arla.compras') }}" class="btn btn-success btn-sm me-2">
                <i class="bi bi-cart-plus"></i> Nova Compra
            </a>
            <a href="{{ url_for('arla.lancamento') }}" class="btn btn-warning btn-sm me-2">
                <i class="bi bi-arrow-right-circle"></i> Novo Lançamento
            </a>
            <a href="{{ url_for('arla.preco_venda') }}" class="btn btn-info btn-sm">
                <i class="bi bi-currency-dollar"></i> Alterar Preço
            </a>
        </div>
    </div>

    <!-- SALDO INICIAL -->
    <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center" style="background:#92a7be;font-weight:600;">
            <span>Saldo Inicial</span>
            {% if saldo %}
            <a href="{{ url_for('arla.editar_saldo_inicial', id=saldo.id) }}" class="btn btn-sm btn-warning" title="Editar">
                <i class="bi bi-pencil"></i> Editar
            </a>
            {% endif %}
        </div>
        <div class="card-body">
            {% if saldo %}
                <ul style="margin-bottom:0;">
                    <li><strong>Data:</strong> {{ saldo.data.strftime('%d/%m/%Y') if saldo.data else '-' }}</li>
                    <li><strong>Volume:</strong> {{ "{:,.2f}".format(saldo.volume_inicial).replace(',', 'X').replace('.', ',').replace('X', '.') }} litros</li>
                    <li><strong>Preço Médio Compra:</strong> R$ {{ "{:,.2f}".format(saldo.preco_medio_compra).replace(',', 'X').replace('.', ',').replace('X', '.') }}</li>
                    <li><strong>Encerrante Inicial:</strong> {{ "{:,.2f}".format(saldo.encerrante_inicial).replace(',', 'X').replace('.', ',').replace('X', '.') }}</li>
                </ul>
            {% else %}
                <span class="text-muted"><i class="bi bi-info-circle"></i> Não há saldo inicial cadastrado.</span>
            {% endif %}
        </div>
    </div>

    <!-- COMPRAS -->
    <div class="card mb-3">
        <div class="card-header" style="background:#a4d7ac;font-weight:600;">
            Compras
        </div>
        <div class="card-body table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Quantidade (litros)</th>
                        <th>Preço Compra</th>
                        <th>Valor Total</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% if compras %}
                        {% for compra in compras %}
                        <tr>
                            <td>{{ compra.data.strftime('%d/%m/%Y') if compra.data else '-' }}</td>
                            <td>{{ "{:,.2f}".format(compra.quantidade).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td>R$ {{ "{:,.2f}".format(compra.preco_compra).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td>R$ {{ "{:,.2f}".format(compra.quantidade * compra.preco_compra).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td class="text-center">
                                <a href="{{ url_for('arla.editar_compra', id=compra.id) }}" class="btn btn-sm btn-warning" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted" style="padding: 1rem;">
                                <i class="bi bi-inbox"></i> Nenhuma compra registrada.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- LANÇAMENTOS -->
    <div class="card mb-3">
        <div class="card-header" style="background:#ffe29a;font-weight:600;">
            Lançamentos
        </div>
        <div class="card-body table-responsive">
            <table class="table table-hover table-sm mb-0">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Encerrante Final</th>
                        <th>Quantidade Vendida</th>
                        <th>Preço Venda Aplicado</th>
                        <th>Valor Total</th>
                        <th class="text-center">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% if lancamentos %}
                        {% for lanc in lancamentos %}
                        <tr>
                            <td>{{ lanc.data.strftime('%d/%m/%Y') if lanc.data else '-' }}</td>
                            <td>{{ "{:,.2f}".format(lanc.encerrante_final).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td>{{ "{:,.2f}".format(lanc.quantidade_vendida).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td>R$ {{ "{:,.2f}".format(lanc.preco_venda_aplicado).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td>R$ {{ "{:,.2f}".format(lanc.quantidade_vendida * lanc.preco_venda_aplicado).replace(',', 'X').replace('.', ',').replace('X', '.') }}</td>
                            <td class="text-center">
                                <a href="{{ url_for('arla.editar_lancamento', id=lanc.id) }}" class="btn btn-sm btn-warning" title="Editar">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted" style="padding: 1rem;">
                                <i class="bi bi-inbox"></i> Nenhum lançamento registrado.
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- PREÇO VIGENTE -->
    <div class="card mb-3">
        <div class="card-header" style="background:#85e6e6;font-weight:600;">
            Preço Atual
        </div>
        <div class="card-body">
            {% if preco %}
               <ul style="margin-bottom:0;">
                   <li><strong>Valor:</strong> <span style="color:#17963c;">R$ {{ "{:,.2f}".format(preco.preco_venda).replace(',', 'X').replace('.', ',').replace('X', '.') }}</span></li>
                   <li><strong>Desde:</strong> {{ preco.data_inicio.strftime('%d/%m/%Y') if preco.data_inicio else '-' }}</li>
               </ul>
            {% else %}
                <span class="text-muted"><i class="bi bi-info-circle"></i> Sem preço vigente cadastrado.</span>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .table th { font-weight:600; font-size:0.95rem; }
    .table td { font-size:0.92rem; }
    .btn-sm { font-size: 0.8rem; padding:0.32rem 0.7rem;}
    @media (max-width: 768px) {
        h2 { font-size: 1.2rem !important; }
        .table { font-size: 0.8rem !important; }
    }
</style>
{% endblock %}
